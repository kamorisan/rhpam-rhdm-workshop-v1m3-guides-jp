# 5. ケースプロジェクトの作成

このセクションでは、以下の内容について説明します:

1. ケースを作成するための業務の前提条件
2. このケースの変数とロール

## 概要
プロセスを自動化する場合の最初のステップは、プロセスの様々なステップと構造を明示的に定義することです。

クレジットカード所持者がチャージバックの申請を行うと、どうなるのか？
チャージバック申請の処理は一筋縄ではいきません。
事前に定義された、構造化された流れの中でプロセスを進行していくことはありません。
プロセスインスタンスの実行中に行われた **人間の意思決定** に応じて、そして最も重要なのは、ケースのデータに応じて、それはチャージバック申請を解決するために、異なるステップと異なる _登場人物_ の間を行ったり来たりします。

_NOTE: 本モジュールのセクション2.ユースケースについて にて、ユースケースの概要と登場人物の詳細について紹介しているので、適宜確認してみてください。_

これは動的で、構造化されていない、データ駆動型のプロセスなので、モデル化するための最良の方法は、`ケース` としてモデル化することです。

この特定の `ケース` では、チャージバック申請を解決するというゴールがありますが、そのゴールに至るまでの手順や順序を予測することはできません。
私たちが知っているステップの一つは、_クレジットカード発行者_ がクレジットカード所有者とカード加盟店から情報を収集し、_ケースファイル_ に保存することです。

_NOTE: 実際には、**クレジットカード発行者** はクレジットカード処理業者（アクワイアラー）と取引を行い、カード加盟店とは直接取引を行いませんが、簡単のために加盟店を考慮に入れています。_

![Business Central CC Dispute Diagram Users]({% image_path business-central-cc-dispute-diagram-users.png %}){:width="400px"}

## オーサリングツール

ケースとプロセスをモデル化するために、Business Central はWebベースのBPMN2デザイナーを提供しています。プロセスとケースのデザイナーについて詳しく見てみましょう:

![Business Central Designer Explained - Stunner]({% image_path business-central-stunner-explained.png %}){:width="800px"}

それぞれの要素について、もう少し理解しておきましょう:

1. _モデリングキャンバス_ : これはあなたの描画ボードです。キャンバス上にさまざまなオブジェクトをドロップした後、オブジェクトを移動させたり、連結したりすることができます。キャンバス上のオブジェクトをクリックすると、拡張可能なプロパティウィンドウでそのプロパティを設定することができます(3)。また、オブジェクトの名前を変更したり、接続するオブジェクトを作成したり、オブジェクトを他のタスクタイプに変形させたりすることもできます。

2. _ツールバー_ : ツールバーには、デザイナーが提供する膨大な数の機能が含まれています。これらには、キャンバス上に存在するオブジェクトに対して実行できる操作が含まれています。個々の操作は、選択されている内容に応じて無効化または有効化されます。例えば、オブジェクトが選択されていない場合、切り取り/貼り付け/削除の操作は無効になっており、オブジェクトを選択すると有効になります。ツールバーのアイコンにカーソルを合わせると、操作の説明テキストが表示されます。

3. _プロパティパネル_ : デザイナーの右側にあるこの拡張可能なセクションでは、プロセスとオブジェクトの両方のプロパティを設定することができます。キャンバス内のオブジェクトをクリックすると、このパネルがリロードされ、そのオブジェクトタイプに固有のプロパティが表示されます。キャンバス自体（オブジェクト上ではなく）をクリックすると、パネルには一般的なプロセスプロパティが表示されます。

4. _オブジェクトライブラリパネル_ : デザイナーの左側にある拡張可能なセクションは、BPMN2（デフォルト）要素ツリーを示しています。これには、プロセスやケースを組み立てるのに使用できるRHPAM BPMN2のテンプレートが含まれています。各セクションのサブグループを展開すると、オブジェクトをドラッグ＆ドロップすることでキャンバス(1)に配置することができます。

5. _ビュー タブ_ : 現在、デザイナーは3つのタブを提供しています。モデル、概要、ドキュメントです。モデルはデフォルトのタブです。概要は、アセットの履歴、コメント、その他のメタデータを表示します。ドキュメント タブには、プロセス定義から生成されたドキュメントが表示されます。

6. _アラート タブ_ : デザイナー の下部には、Business Central がプロジェクトのビルド中に見つかったプロセスやコードの検証に関する警告やエラーに関するアラートを表示するセクションがあります。


## ケースの変数とロール

前回のモジュールで _データオブジェクト_ と _ビジネス・デシジョン_ を定義しました。モジュール2のラボを終えた方は、既存のプロジェクトを使用することができます。

NOTE: _最初からやり直したい場合は、`ccd-project` プロジェクトを削除して、以下の URL を使って再インポートすることができます: [https://github.com/kamorisan/rhpam-rhdm-workshop-v1m3-labs-step-1.git](https://github.com/kamorisan/rhpam-rhdm-workshop-v1m3-labs-step-1.git)_

### ケース定義の作成

ケース定義を作成する方法:

1. ライブラリビューに移動し、`アセットの追加` をクリックします。アセットカタログから `ケース定義` を選択し、以下の値を設定します。

  * 名前: `ChargeDispute`
  * パッケージ: `com.myspace.ccd_project`

  ![Business Central Asset New Case ]({% image_path ccd-add-case-definition.png %}){:width="600px"}

  ![Business Central New Case Details ]({% image_path ccd-project-add-case-definition-charge-dispute.png %}){:width="600px"}


#### ケースファイル変数の定義

最初にケース変数を定義します。これらの変数は、ケースの実行中にケースデータを格納するために使用されます。

1. 画面右側のプロパティパネルで、下までスクロールして `ケース管理` セクションを展開します。`ケースファイル変数` のテーブルに、以下の変数を追加します。:

	| Name            | Data Type     |
	| --------------- |:-------------:|
	| customerStatus  | String |
	| totalFraudAmount| Float  |
	| fraudData | FraudData      |
	| approvedChargeback | Boolean |
	| creditCardholder | creditCardholder |

    最後に、ケースファイル変数の定義は次のようになります:

    ![Business Central Variable Definitions]({% image_path case-file-variables.png %}){:width="400px"}

2. `保存` ボタンをクリックしてアセットを保存します。

#### ロールの定義

チャージバック申請のケースでは、異なるロールを識別することができます。ユーザー および/または グループのこれらのケース・ロールへのマッピングは、ケース・インスタンスが開始されたときに行われ、後から変更することができます。

1. プロパティパネルで `ケースロール` テーブルを探してください（`ケースファイル変数` 定義のすぐ上）。以下のロールを追加します。

  | Name             | Cardinality |
  | ---------------- |:-----------:|
  | owner            | 1           |
  | approval-manager | 1           |

`Cardinality` とは、ロールにマッピングできるアクターの数を指します。

![Business Central Case Roles]({% image_path case-roles.png %}){:width="400px"}

`保存` ボタンをクリックしてアセットを保存します。

----- 

ここまでで、ケースを始めるための基本的な情報を定義しました。
それでは、既存のデータに基づいてケースを推進する方法を理解し、いくつかのマイルストーンを定義してみましょう。
